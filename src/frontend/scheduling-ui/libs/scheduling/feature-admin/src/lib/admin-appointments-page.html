<div class="header">
  <div>
    <h1>Admin Â· Appointments</h1>
    <p class="muted">
      Server-side paging and filtering via /api/admin/appointments.
    </p>
  </div>
</div>

<mat-card class="card">
  <mat-card-title>Filters</mat-card-title>
  <mat-card-content [formGroup]="filters" class="filters">
    <mat-form-field class="filters__search">
      <mat-label>Search (name/email)</mat-label>
      <input matInput formControlName="search" />
    </mat-form-field>

    <mat-form-field class="filters__status">
      <mat-label>Status</mat-label>
      <mat-select formControlName="status">
        <mat-option value="">All</mat-option>
        <mat-option value="Booked">Booked</mat-option>
        <mat-option value="Cancelled">Cancelled</mat-option>
      </mat-select>
    </mat-form-field>

    <div class="filters__actions">
      <button mat-raised-button color="primary" (click)="apply()">Apply</button>
      <button mat-button (click)="reset()">Reset</button>
      <mat-progress-spinner
        *ngIf="loading()"
        diameter="22"
        mode="indeterminate"
      ></mat-progress-spinner>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="card">
  <mat-card-title>Results</mat-card-title>
  <mat-card-content>
    <div class="tableWrap">
      <table mat-table [dataSource]="rows()" class="table" *ngIf="!loading()">
        <ng-container matColumnDef="createdAtUtc">
          <th mat-header-cell *matHeaderCellDef>Created</th>
          <td mat-cell *matCellDef="let r">
            {{ r.createdAtUtc | date: 'short' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="providerName">
          <th mat-header-cell *matHeaderCellDef>Provider</th>
          <td mat-cell *matCellDef="let r">{{ r.providerName }}</td>
        </ng-container>

        <ng-container matColumnDef="slotStartUtc">
          <th mat-header-cell *matHeaderCellDef>Slot</th>
          <td mat-cell *matCellDef="let r">
            {{ r.slotStartUtc | date: 'short' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customerEmail">
          <th mat-header-cell *matHeaderCellDef>Customer</th>
          <td mat-cell *matCellDef="let r">{{ r.customerEmail }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let r">{{ r.status }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let r" class="actionsCol">
            <button
              mat-stroked-button
              color="warn"
              (click)="cancel(r)"
              [disabled]="r.status !== 'Booked'"
            >
              Cancel
            </button>
            <button
              mat-stroked-button
              (click)="reschedule(r)"
              [disabled]="r.status !== 'Booked'"
            >
              Reschedule
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="cols"></tr>
        <tr mat-row *matRowDef="let row; columns: cols;"></tr>
      </table>
    </div>

    <mat-paginator
      [length]="totalCount()"
      [pageSize]="pageSize()"
      [pageIndex]="page() - 1"
      [pageSizeOptions]="[10, 20, 50]"
      (page)="onPage($event)"
    >
    </mat-paginator>
  </mat-card-content>
</mat-card>
